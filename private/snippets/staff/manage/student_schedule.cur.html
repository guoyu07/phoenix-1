<div id="student_info" class="content-row spaced">
    <div class="col-row">
        <div class="col c7" style="vertical-align:top;">
            <h1>{{name}}</h1>
            {{note}}

            <p><button class="button-link" data-url="/staff/manage/family_view.php?fid={{family_id}}">Family Page</button></p>
            
            <h2>Current Schedule </h2>

            <p>This schedule was last updated at <strong>{{last_update}}</strong> HKT.</span></p>

            {{submit_note}}

            <p style="margin-top:10px;"><button type="button" class="button-blue" onclick="window.open('/account/print_schedule.php?sid={{sid}}&v={{v}}');">Print Schedule</button></p>
            
            <h3>Week 1: June 24-28</h3>
            <table id="w1">
                <thead>
                    <tr>
                        <th style="width:20%;">Period/Session</th>
                        <th style="width:50%;">Course</th>
                        <th style="width:30%;">Status</th>
                    </tr>
                </thead>
                <tbody>
                    {{week_1}}
                </tbody>
            </table>

            <h3>Week 2: July 2-5</h3>
            <div class="alert alert-yellow">There is no school (and no fees charged) for the July 1 public holiday.</div>
            <table id="w2">
                <thead>
                    <tr>
                        <th style="width:20%;">Period/Session</th>
                        <th style="width:50%;">Course</th>
                        <th style="width:30%;">Status</th>
                    </tr>
                </thead>
                <tbody>
                    {{week_2}}
                </tbody>
            </table>

            <h3>Week 3: July 8-12</h3>
            <table id="w3">
                <thead>
                    <tr>
                        <th style="width:20%;">Period/Session</th>
                        <th style="width:50%;">Course</th>
                        <th style="width:30%;">Status</th>
                    </tr>
                </thead>
                <tbody>
                    {{week_3}}
                </tbody>
            </table>

            <h3>Week 4: July 15-19</h3>
            <table id="w4">
                <thead>
                    <tr>
                        <th style="width:20%;">Period/Session</th>
                        <th style="width:50%;">Course</th>
                        <th style="width:30%;">Status</th>
                    </tr>
                </thead>
                <tbody>
                    {{week_4}}
                </tbody>
            </table>

        </div>
        <div class="col c3">
            <h2>Add a Class</h2>
            <p>To search for a class to add, type it in the format SUBJ001,4,3. Enrollments past maximum class size will be done automatically but you will be warned if that's the case.</p>
            <p>
                <input type="text" id="class_input" placeholder="ARTS001,1,2" />
            </p>
            <div id="ci_response">
            </div>

            <h2>Student Profile</h2>
            <p>
                <strong>Full Name</strong><br />
                {{last_name}}, {{first_name}}<br /><span class="muted">(Preferred: {{preferred_name}} {{last_name}})</span>
            </p>

            <p>
                <strong>DOB</strong><br />
                {{dob}} <span class="muted">(Age: {{age}})</span>
            </p>

            <h2>Emergency &amp; Medical</h2>

            <p>
                <strong>Medical Conditions</strong><br />
                {{med_cond}}
            </p>

            <p>
                <strong>Medications</strong><br />
                {{med_meds}}
            </p>

        </div>
    </div>
</div>

<script type="text/javascript">
$(document).ready(function () {
    $('#class_input').keydown(function() {
        if (event.keyCode == 13) {
            $('#ci_response').html('<span class="muted"><em>Searching, please wait&hellip;</em></span>');
            $.getJSON('/staff/addclass_rpc.php', {'str': $('#class_input').val(), 'sid': {{sid}} }, function(ret) {
                // Was class valid?
                if (ret.status == 'failure') {
                    $('#ci_response').html('<div class="alert alert-red"><strong>An error occured!</strong><br />' + ret.msg + '</div>');
                } else if (ret.full) {
                    $('#ci_response').html('<div class="alert alert-yellow">Class is already full but I overrode it for you. To remove the class, refresh and drop it.</div>');
                } else {
                    $('#ci_response').html('<div class="alert alert-green">Class was successfully added! Refresh to see changes!</div>');
                }
            });
        }
    });

    $('.droppable').click(function () {
        var eid = $(this).data('eid');
        $.getJSON('/staff/dropclass_rpc.php', {'eid': eid, 'sid': {{sid}} }, function(ret) {
            laoshi.toast('Class dropped successfully. Refresh to see changes');
        });
    })
});

function forceSubmit() {
    laoshi.rpc({"method": "force_submit", "sid": {{sid}} });
    laoshi.toast('Student schedule was submitted. Refresh to see changes.');
}
</script>