<div class="content-row spaced">
    <div class="navrow">
        <ul>
            <li><a href="#/schedule" class="active" data-activate="schedule">Current Schedule</a></li>
            <li><a href="#/history" data-activate="history">Enrollment History</a></li>
            <li><a href="#/registration" data-activate="registration">Program Attendance</a></li>
        </ul>
    </div>
</div>

<div id="student_info" class="content-row spaced">
    <div class="col-row">
        <div class="col c7" style="vertical-align:top;">
            <h1>{{name}} (#{{sid}})</h1>

            {{note}}

            <p><button class="button-link" data-url="/staff/manage/family_view.php?fid={{family_id}}">Family #{{family_id}}</button> <button class="button-link button-green" data-url="/staff/manage/invoices.php?fid={{family_id}}">Family #{{family_id}} Invoice</button> <button type="button" class="button-blue" onclick="window.open('/account/print_schedule.php?sid={{sid}}&v={{v}}');">Print Schedule</button> <button type="button" class="button-red" onclick="forceAbsent();">Mark Absent</button></p>
            
            <div id="schedule" class="nav_content">
                <h2>Current Schedule </h2>

                <p>This schedule was last updated at <strong>{{last_update}}</strong> HKT.</span></p>

                {{submit_note}}

                <table id="w1" class="hiden">
                    <thead>
                        <tr>
                            <th style="width:65%;">Course</th>
                            <th style="width:18%;">Status</th>
                            <th style="width:17%;">Drop</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="3" style="background-color:#fff;font-weight:bold;"><h3 style="margin-top:0;">Week 1: June 24-28</h3></td>
                        </tr>
                        {{week_1}}
                        <tr>
                            <td colspan="3" style="background-color:#fff;font-weight:bold;"><h3 style="margin-top:0;">Week 2: July 2-5</h3></td>
                        </tr>
                        {{week_2}}
                        <tr>
                            <td colspan="3" style="background-color:#fff;font-weight:bold;"><h3 style="margin-top:0;">Week 3: July 8-12</h3></td>
                        </tr>
                        {{week_3}}
                        <tr>
                            <td colspan="3" style="background-color:#fff;font-weight:bold;"><h3 style="margin-top:0;">Week 4: July 15-19</h3></td>
                        </tr>
                        {{week_4}}
                    </tbody>
                </table>
            </div>

            <div id="history" class="nav_content hide">
                <h2>Enrollment History</h2>

                <table id="history_table" class="hiden">
                    <thead>
                        <tr>
                            <th style="width:80%;">Course</th>
                            <th style="width:20%;">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="2" style="background-color:#fff;font-weight:bold;"><h3 style="margin-top:0;">Week 1: June 24-28</h3></td>
                        </tr>
                        {{history_1}}
                        <tr>
                            <td colspan="2" style="background-color:#fff;font-weight:bold;"><h3 style="margin-top:0;">Week 2: July 2-5</h3></td>
                        </tr>
                        {{history_2}}
                        <tr>
                            <td colspan="2" style="background-color:#fff;font-weight:bold;"><h3 style="margin-top:0;">Week 3: July 8-12</h3></td>
                        </tr>
                        {{history_3}}
                        <tr>
                            <td colspan="2" style="background-color:#fff;font-weight:bold;"><h3 style="margin-top:0;">Week 4: July 15-19</h3></td>
                        </tr>
                        {{history_4}}
                    </tbody>
                </table>

                <p style="margin-top:2em;"><a href="javascript:;" onclick="$('#hispre').toggle('fade');">Toggle ChesterData&reg;</a></p>
                <pre id="hispre" class="hide">{{history_json}}</pre>

            </div>


            <div id="registration" class="nav_content hide">
                <h2>Attendance History</h2>

                <table id="registration_history">
                    <thead>
                        <tr>
                            <th style="width:15%;">Date</th>
                            <th style="width:67%;">Course</th>
                            <th style="width:18%;">Status</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td colspan="3" style="background-color:#fff;font-weight:bold;"><h3 style="margin-top:0;">Week 1: June 24-28</h3></td>
                        </tr>
                        {{reghis_1}}
                        <tr>
                            <td colspan="3" style="background-color:#fff;font-weight:bold;"><h3 style="margin-top:0;">Week 2: July 2-5</h3></td>
                        </tr>
                        {{reghis_2}}
                        <tr>
                            <td colspan="3" style="background-color:#fff;font-weight:bold;"><h3 style="margin-top:0;">Week 3: July 8-12</h3></td>
                        </tr>
                        {{reghis_3}}
                        <tr>
                            <td colspan="3" style="background-color:#fff;font-weight:bold;"><h3 style="margin-top:0;">Week 4: July 15-19</h3></td>
                        </tr>
                        {{reghis_4}}
                    </tbody>
                </table>

                <p style="margin-top:2em;"><a href="javascript:;" onclick="$('#reghispre').toggle('fade');">Toggle ChesterData&reg;</a></p>
                <pre id="reghispre" class="hide">{{test}}</pre>

            </div>

        </div>
        <div class="col c3">
            <h2>Add a Class</h2>
            <p>To search for a class to add, type it in the format SUBJ001,4,3. Enrollments past maximum class size will be done automatically but you will be warned if that's the case.</p>
            <p>
                <input type="text" id="class_input" placeholder="ARTS001,1,2" />
            </p>
            <div id="ci_response">
            </div>

            <h2>Student Profile</h2>
            <p>
                <strong>Full Name</strong><br />
                {{last_name}}, {{first_name}} <span class="muted">({{preferred_name}})</span>
            </p>

            <p>
                <strong>Date of Birth</strong><br />
                {{dob}} <span class="muted">(Aged {{age}})</span>
            </p>

            <p>
                <strong>Gender</strong><br />
                {{gender}}</span>
            </p>

            <p>
                <strong>Day School</strong><br />
                {{school}}</span>
            </p>

            <h2>Emergency &amp; Medical</h2>

            <p>
                <strong>Medical Conditions</strong><br />
                {{med_cond}}
            </p>

            <p>
                <strong>Medications</strong><br />
                {{med_meds}}
            </p>

            <p>
                <strong>Emergency Contact</strong><br />
                {{emer_name}} <span class="muted">({{emer_relation}})</span><br />
                <span class="red strong">{{emer_phone}}</span>
            </p>

        </div>
    </div>
</div>

<script type="text/javascript">
$(document).ready(function () {
    $('#class_input').keydown(function() {
        if (event.keyCode == 13) {
            $('#ci_response').html('<span class="muted"><em>Searching, please wait&hellip;</em></span>');
            $.getJSON('/staff/addclass_rpc.php', {'str': $('#class_input').val(), 'sid': {{sid}} }, function(ret) {
                // Was class valid?
                if (ret.status == 'failure') {
                    $('#ci_response').html('<div class="alert alert-red"><strong>An error occured!</strong><br />' + ret.msg + '</div>');
                } else if (ret.full) {
                    $('#ci_response').html('<div class="alert alert-yellow">Class is already full but I overrode it for you. To remove the class, refresh and drop it.</div>');
                    $('#class_input').val('');
                } else {
                    $('#ci_response').html('<div class="alert alert-green">Class was successfully added! Refresh to see changes!</div>');
                    $('#class_input').val('');
                }
            });
        }
    });

    if ($('#' + window.location.hash.split('/')[1]).length) {
        var item = window.location.hash.split('/')[1];
        $('.nav_content').hide();
        $('a.active').removeClass('active');
        $('a[data-activate=' + item + ']').addClass('active');
        $('#' + item).fadeIn();
        window.location.hash = '/' + item;
    }

    $('.navrow li a').click(function () {
        $('.nav_content').hide();
        $('a.active').removeClass('active');
        $(this).addClass('active');
        $('#' + $(this).data('activate')).fadeIn();
        window.location.hash = '/' + $(this).data('activate');
    });

    $('.droppable').click(function () {
        var eid = $(this).data('eid');
        $.getJSON('/staff/dropclass_rpc.php', {'eid': eid, 'sid': {{sid}} }, function(ret) {
            laoshi.toast('Class dropped successfully. Refresh to see changes');
        });
    })
});

function forceSubmit() {
    laoshi.rpc({"method": "force_submit", "sid": {{sid}} });
    laoshi.toast('Student schedule was submitted. Refresh to see changes.');
}

function forceAbsent() {
    {{absent_ajax}}
    laoshi.toast('Set student absent for all of today\'s classes. Auto-refresh in 3 seconds&hellip;');
    setTimeout("location.reload()", 3000);
}
</script>