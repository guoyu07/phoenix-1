<div id="course_list" class="content-row spaced body-emulate">
    <h2>List of Students</h2>
    
    <p><input id="search" type="text" style="width:200px;" placeholder="Enter search term&hellip;" />
        <button type="button" onclick="toggleFail();">Toggle Problem Schedules On/Off</button></p>

    <table class="students">
        <thead>
            <tr>
                <th style="width:7%;" class="tipped" title="Family ID Number">FID</th>
                <th style="width:8%;" class="tipped" title="Student ID Number">SID</th>
                <th style="width:25%;" class="tipped" title="Click to edit family/child details">Student Name</th>
                <th style="width:10%;">DOB</th>
                <th style="width:15%;">Submit Date</th>
            </tr>
        </thead>
        <tbody id="tb_student">
        </tbody>
    </table>
</div>

<script type="text/javascript">
var toggleFailed = false;
var stuJson = {{stu_json}}

$(document).ready(function() {
    // Bind search


    // Load table
    $.each(stuJson, function(i, stu) {
        // einfo = stu.EnrollInfo;

        // // Calculate classes
        // var w1c = 0;
        // var w2c = 0;
        // var w3c = 0;
        // var w4c = 0;
        // var w1f = 0;
        // var w2f = 0;
        // var w3f = 0;
        // var w4f = 0;
        // var fail = 0;

        // // Week 1
        // if (!!einfo.W1P1) w1c = w1c+1;
        // if (!!einfo.W1P2) {
        //     w1c = w1c+1;
        // } else if (!!einfo.W1P1 && (!!einfo.W1P3 || !!einfo.W1P4)) w1f = 1;
        // if (!!einfo.W1P3) {
        //     w1c = w1c+1;
        // } else if (!!einfo.W1P4 && (!!einfo.W1P1 || !!einfo.W1P2)) w1f = 1;
        // if (!!einfo.W1P4) w1c = w1c+1;
        // if (!!einfo.W1PA) w1c = w1c+1;
        // if (!!einfo.W1PB) w1c = w1c+1;
        // if (!!einfo.W1PC) w1c = w1c+1;

        // // Week 2
        // if (!!einfo.W2P1) w2c = w2c+1;
        // if (!!einfo.W2P2) {
        //     w2c = w2c+1;
        // } else if (!!einfo.W2P1 && (!!einfo.W2P3 || !!einfo.W2P4)) w2f = 1;
        // if (!!einfo.W2P3) {
        //     w2c = w2c+1;
        // } else if (!!einfo.W2P4 && (!!einfo.W2P1 || !!einfo.W2P2)) w2f = 1;
        // if (!!einfo.W2P4) w2c = w2c+1;
        // if (!!einfo.W2PA) w2c = w2c+1;
        // if (!!einfo.W2PB) w2c = w2c+1;
        // if (!!einfo.W2PC) w2c = w2c+1;

        // // Week 3
        // if (!!einfo.W3P1) w3c = w3c+1;
        // if (!!einfo.W3P2) {
        //     w3c = w3c+1;
        // } else if (!!einfo.W3P1 && (!!einfo.W3P3 || !!einfo.W3P4)) w3f = 1;
        // if (!!einfo.W3P3) {
        //     w3c = w3c+1;
        // } else if (!!einfo.W3P4 && (!!einfo.W3P1 || !!einfo.W3P2)) w3f = 1;
        // if (!!einfo.W3P4) w3c = w3c+1;
        // if (!!einfo.W3PA) w3c = w3c+1;
        // if (!!einfo.W3PB) w3c = w3c+1;
        // if (!!einfo.W3PC) w3c = w3c+1;

        // // Week 4
        // if (!!einfo.W4P1) w4c = w4c+1;
        // if (!!einfo.W4P2) {
        //     w4c = w4c+1;
        // } else if (!!einfo.W4P1 && (!!einfo.W4P3 || !!einfo.W4P4)) w4f = 1;
        // if (!!einfo.W4P3) {
        //     w4c = w4c+1;
        // } else if (!!einfo.W4P4 && (!!einfo.W4P1 || !!einfo.W4P2)) w4f = 1;
        // if (!!einfo.W4P4) w4c = w4c+1;
        // if (!!einfo.W4PA) w4c = w4c+1;
        // if (!!einfo.W4PB) w4c = w4c+1;
        // if (!!einfo.W4PC) w4c = w4c+1;

        // if ((w1f == 1) || (w2f == 1) || (w3f == 1) || (w4f == 1)) fail = 1;


        // $('#tb_student').append('<tr class="' + ((fail == 1) ? 'sched-fail' : 'sched-pass') + '">' +
        //     '<td><a href="/staff/manage/family_view.php?fid=' + stu.FamilyID + '" onclick="window.open(this.href);return false;">' + stu.FamilyID + '</a></td>' +
        //     '<td>S' + stu.StudentID + '</td>' +
        //     '<td><a href="/staff/manage/student_schedule.php?sid=' + stu.StudentID + '">' + stu.StudentNamePreferred + ' ' + stu.StudentNameLast + '</a></td>' +
        //     '<td>' + stu.StudentDOB + '</td>' +
        //     '<td>' + ((stu.StudentSubmitted == '1') ? stu.StudentSubmitTS : '<em class="muted">Not submitted</em>') + '</td>' +
        //     '<td>' + ((w1f == 1) ? '<img src="/assets/icons/exclamation.png" />' : '') + w1c + '/' + ((w2f == 1) ? '<img src="/assets/icons/exclamation.png" />' : '') + w2c + '/' + ((w3f == 1) ? '<img src="/assets/icons/exclamation.png" />' : '') + w3c + '/' + ((w4f == 1) ? '<img src="/assets/icons/exclamation.png" />' : '') + w4c + '</td>' +
        //     '<td>' + ((stu.StudentSubmitted == '1') ? '<a href="javascript:;" onclick="toggleChecked(' + stu.StudentID + ');" id="stu-' + stu.StudentID + '-status">' + ((stu.StudentIC == 1) ? '<img src="/assets/icons/tick.png" /> Verified' : '<img src="/assets/icons/cross.png" /> Not verified' ) + '</a>' : '<em class="muted">Schedule not submitted</em>') + '</td>'
        // );
        
        $('#tb_student').append('<tr class="sched-pass">' +
            '<td><a href="/staff/manage/family_view.php?fid=' + stu.FamilyID + '" onclick="window.open(this.href);return false;">' + stu.FamilyID + '</a></td>' +
            '<td>S' + stu.StudentID + '</td>' +
            '<td><a href="/staff/manage/student_schedule.php?sid=' + stu.StudentID + '">' + stu.StudentNamePreferred + ' ' + stu.StudentNameLast + '</a></td>' +
            '<td>' + stu.StudentDOB + '</td>' +
            '<td>' + ((stu.StudentSubmitted == '1') ? stu.StudentSubmitTS : '<em class="muted">Not submitted</em>') + '</td></tr>'); /* +
            '<td><em class="muted">Hidden</em></td>' +
            '<td>' + ((stu.StudentSubmitted == '1') ? '<a href="javascript:;" onclick="toggleChecked(' + stu.StudentID + ');" id="stu-' + stu.StudentID + '-status">' + ((stu.StudentIC == 1) ? '<img src="/assets/icons/tick.png" /> Verified' : '<img src="/assets/icons/cross.png" /> Not verified' ) + '</a>' : '<em class="muted">Schedule not submitted</em>') + '</td>' 
        );*/
    });

    
    var $rows = $('.students tbody tr');
    $('#search').keyup(function() {
        var val = $.trim($(this).val()).replace(/ +/g, ' ').toLowerCase();

        $rows.show().filter(function() {
            var text = $(this).text().replace(/\s+/g, ' ').toLowerCase();
            return !~text.indexOf(val);
        }).hide();
        
    });

});

function toggleFail() {
    if (toggleFailed == false) {
        toggleFailed = true;
        $('.sched-pass').hide();
    } else {
        toggleFailed = false;
        $('.sched-pass').show();
    }
}

function toggleChecked(sid) {
    var sendObj = {'method': 'mark_student_verified', 'sid': sid};
    laoshi.rpc(sendObj);
    laoshi.toast('Student verification status changed!');
    var orig = $('#stu-' + sid + '-status').html();
    $('#stu-' + sid + '-status').html(((orig.match(/\sNot\s/)) ? '<img src="/assets/icons/tick.png" /> Verified' : '<img src="/assets/icons/cross.png" /> Not Verified'));
}
</script>