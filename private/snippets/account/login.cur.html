<div class="content-row spaced">
	<h1>Sign In</h1>
</div>

<div class="content-row spaced" style="display:table;">
	<div class="col-row">
		<div id="reg-start" class="col c6" style="border: 1px solid #ccc;background-color: #fff;">
			<h2>Existing users, sign in here...</h2>
			<p>Sign in to manage your children's schedules and access the Help Desk. </p>
			{{error}}
			<form class="short validate" action="./login.php" method="post" id="login-form" enctype="multipart/form-data">
				<div class="form-row" id="form-email">
					<label for="email-input">Email address</label>
					<input type="email" id="email-input" name="email" class="required" />
				</div>
				<div class="form-row" id="form-pass">
					<label for="pass-input">Password</label>
					<input type="password" id="pass-input" name="pass" class="required" />
				</div>
				<div id="pass-hint"><p class="muted">If you've forgotten your password, complete the email address field and then click the Reset Password button below.</p></div>
				<div class="form-row no-label">
					<button type="submit" class="button-green">Sign In</button>
					<button type="button" id="button-pass-reset">Reset Password</button>
				</div>
			</form>
		</div>
		<div id="login-container" class="col c4" style="border: 1px solid #ccc;border-left: 0;background-color: #fafafa;">
			<h2>Don't have an account?</h2>
			<p>Create an account and register your family today! All you'll need is your family information and a valid email address.</p>
			
			<form class="reversed" action="./register.php?o=loginform" method="post" enctype="multipart/form-data">
                <div class="form-row">
                	<label for="input-regname">Parent's name</label>
                	<input type="text" id="input-regname" name="name" />
                </div>
    			<div class="form-row">
        			<label for="input-regemail">Parent's email</label>
        			<input type="email" id="input-regemail" name="email" placeholder="name@example.com" />
    			</div>
				<div class="muted form-row">
        			<p>We'll need to verify this, so make sure your email address is valid and accessible.</p>
    			</div>
				<div class="form-row">
					<button type="submit" class="button-blue">Continue Registration</button>
				</div>
			</form>
			
		</div>
	</div>
</div>

<script type="text/javascript">
$(document).ready(function() {
	$('#email-input').focus();
	$('#button-pass-reset').click(function () {
	   forgotPassword();
	})
});

function forgotPassword() {
    if ($('#email-input').val() == '') {
        $('#pass-hint').hide().removeClass('alert alert-green alert-red').addClass('alert alert-red').html('Oops! Enter your email address first so we can look your account up. If you\'ve forgotten that too, send an email to <a href="mailto:tech@summer.cis.edu.hk">tech@summer.cis.edu.hk</a> for assistance.').fadeIn('fast');
        $('#email-input').focus().removeClass('alert alert-green alert-red').html('Looking up your account, please wait...').fadeIn('fast');
    } else {
        // RPC it
        $('#pass-hint').hide();
        $('#form-pass').hide();
        
        $.getJSON('/rpc.php', 'method=resetAccount&data='+$('#email-input').val(), function (res) {
            if (res.responseCode == 2200) {
                // Valid response
                $('#pass-hint').hide().removeClass('alert alert-green alert-red').addClass('alert alert-green').html('We just sent you a link to reset your password to that email address. If after checking your junk mailbox, you cannot locate this email, please contact <a href="mailto:tech@summer.cis.edu.hk">tech@summer.cis.edu.hk</a> after 15 minutes.').fadeIn('fast');
            } else {
                $('#pass-hint').hide().removeClass('alert alert-green alert-red').addClass('alert alert-red').html(res.error).fadeIn('fast');
            }
        });
        var reset = setTimeout(function (){ $('#form-pass').slideDown(); }, 3000);
    }
}
</script>