<div class="content-row spaced">
	<div class="alert alert-yellow"><span class="badge badge-yellow">Attention</span> Do you already have a family account or have registered a child previously? You can add multiple children under the same family account. To do so, just Sign In (use the button at the top of the page) and then click "Add Child Application" once you've logged in.</div>
</div>

<form class="validate" action="./register.php" method="post" id="reg-form" enctype="multipart/form-data">
<div class="content-row spaced">
    <h1>Create an Account</h1>
</div>

<div class="content-row spaced" style="display:table;">
	<div class="col-row" id="basic-info">
		
		<!-- Form block -->
		<div id="form-basic" class="col c7">
			<h2>Parent's Account Information</h2>
			
			{{error}}
			
			<p>Fields with a red asterisk (<span class="red strong">*</span>) are required. Please note that only online registrations are accepted - there is no paper application or brochure. Thank you for helping us be as green and ecofriendly as possible!</p>
			
			<p>You can change your details at any time after registration and logging in.</p>
			
				<div class="form-row" id="form-name">
					<label for="name-input">Parent's name <span class="red strong">*</span></label>
					<input type="text" id="name-input" name="name" class="required" />
				</div>
				<div class="form-row" id="form-email">
					<label for="email-input">Email address <span class="red strong">*</span></label>
					<input type="email" id="email-input" name="email" class="required" placeholder="name@example.com"/>
				</div>
				
				<div class="alert alert-red hide no-label" id="email-invalid"><img src="/assets/icons/cross.png" title="[X]" /> Sorry, we already have an account registered with that address. If you want to enroll another child, you can register additional children if you login to your existing account.</div>
				
				<div class="form-row" id="form-pass">
					<label for="pass-input">Password <span class="red strong">*</span></label>
					<input type="password" id="pass-input" name="pass" class="required" />
				</div>
				<div class="form-hint no-label muted">
                    <p>Must be a minimum of 6 characters.</p>
                    <p><img src="/assets/icons/lock.png" alt="[Lock]" /> We protect your password with bank and military-grade security measures.</p>
                </div>
				
				<div class="alert alert-red hide no-label" id="password-invalid"><img src="/assets/icons/cross.png" title="[X]" /> Your password must be a minimum of six characters. There are no further restrictions for your convenience.</div>
				
				<div class="form-row" id="form-confirm">
					<label for="confirm-input">Confirm password <span class="red strong">*</span></label>
					<input type="password" id="confirm-input" name="confirm" class="required" />
				</div>
				
				<div class="alert alert-red hide no-label" id="confirm-invalid"><img src="/assets/icons/cross.png" title="[X]" /> Your passwords don't match.</div>
		</div>
		
		<!-- Help block -->
		<div id="help-basic" class="col c3 hide-smartphone" style="background-color: #fafafa;">
            <h2>Need help?</h2>
            <h3>Parent's name</h3>
            <p>Parents: please enter your name. You'll be asked to provide a secondary emergency contact for each child at a later time.</p>
            <h3>Email address</h3>
            <p>Enter an email address that you check often as we will send important updates to that account (no spam ever, promise!). Make sure you allow emails ending in <strong>@summer.cis.edu.hk</strong> to get through.</p>
            <p>We'll need to validate this email address by sending you a private link when you submit this form.</p>
            <h3>Password</h3>
            <p>We kindly request that to enhance security, your password have a minimum of six characters.</p>
		</div>
		
	</div>

	<div class="col-row" id="contact-info" style="margin-top:1em;">
		
		<!-- Form block -->
		<div id="form-contact" class="col c7">
			<h2>Contact Information</h2>
			
			<div class="form-row" id="form-locale">
				<label for="locale-input">Residency Status <span class="red strong">*</span></label>
				<select id="locale-input" name="locale" class="required">
                    <option value="HK" selected="selected">Hong Kong</option>
                    <option value="INTL">International</option>
				</select>
			</div>
			
			<div class="form-row" id="form-address">
				<label for="address-input">Home Address <span class="red strong">*</span></label>
				<textarea id="address-input" name="address" class="required"></textarea>
			</div>
            <div class="form-hint muted no-label">Please no PO Boxes</div>
            
            <div class="form-row" id="form-hphone">
            	<label for="hphone-input">Home Phone <span class="red strong">*</span></label>
            	<input type="text" id="hphone-input" name="hphone" class="required" />
            </div>
			
			<div class="form-row" id="form-mphone">
				<label for="hphone-input">Local Mobile Phone &nbsp; <strong>+852</strong></label>
				<input type="text" id="mphone-input" name="mphone" maxlength="8" />
			</div>
		</div>
		
		<!-- Help block -->
		<div id="help-contact" class="col c3 hide-smartphone" style="background-color: #fafafa;">
            <h3>Residency Status</h3>
            <p>This is to let us know whether you and your family currently live in Hong Kong.</p>
            <h3>Home Address</h3>
            <p>Please enter your family's home address - <strong>not your mailing address</strong>. Feel free to read our <a href="/policies.php?privacy" class="tipped" title="Opens in a new window" onclick="window.open(this.href);return false;">Privacy Policy</a>.</p>
            <h3>Home Phone</h3>
            <p>HK residents: enter your 8-digit phone number. Otherwise, enter your foreign home phone number, starting with the country code.<br />
            <span class="muted">Example: 13105551234 for US numbers.</span></p>
            <h3>Local Mobile Phone</h3>
            <p>Please enter your local Hong Kong mobile phone number (for SMS notifications). If you do not have one, leave this field blank.</p>
		</div>
	</div>

	<div class="col-row" id="prefs-info" style="margin-top:1em;">
		
		<!-- Form block -->
		<div id="form-prefs" class="col c7">
			<h2>Your Preferences</h2>
			
			<p>You can change these preferences later as well.</p>
			
			<div class="form-row" id="form-language">
				<label for="lang-input">Preferred Spoken Language <span class="red strong">*</span></label>
				<select id="lang-input" name="lang" class="required">
                    <option value="en" selected="selected">English</option>
                    <option value="zh">Putonghua (Mandarin)</option>
                    <option value="yue">Cantonese</option>
				</select>
			</div>
			<div class="form-help no-label muted">Only English is supported in written communication.</div>
			
			<div class="form-row" id="form-transport-noti" style="padding-top: 1.5em;">
			    <div class="no-label"><strong>Expected Mode of Transportation</strong> <span class="red strong">*</span><br />
    				<label class="nested"><input type="radio" id="trans-bus" name="transport" value="bus" class="required" checked="checked" /> School Bus</label>
    				<label class="nested"><input type="radio" id="trans-car" name="transport" value="car" class="required" /> Car/Taxi</label>
                    <label class="nested"><input type="radio" id="trans-public" name="transport" value="public" class="required" /> Public Transit</label>
                    <label class="nested"><input type="radio" id="trans-foot" name="transport" value="foot" class="required" /> By Foot</label>
                </div>
			</div>
			<div class="no-label muted form-hint">We are interested your children's probable mode of transportation so we can gauge and prevent traffic congestion on Braemar Hill as other schools may still be in session.</div>

            
            <div class="form-row" id="form-buttons" style="margin-top: 3em;">
                <p>
                    <button type="submit" class="button-green" style="float: right;">Submit Registration</button>
                    <button type="reset" class="button" style="float: left;">Reset Form</button>
                </p>
                <div class="clear buffer">&nbsp;</div>
            </div>
            
		</div>
		
		<!-- Help block -->
		<div id="help-prefs" class="col c3 hide-smartphone" style="background-color: #fafafa;">
            <h3>Preferred Spoken Language</h3>
            <p>While not always possible due to personnel reasons, we will try to call you in this language for your convenience. Please note that only English will be used in written communication.</p>
		</div>
	</div>
</div>
</form>

<script type="text/javascript">
function emailCheck(email) {
    var pattern = new RegExp(/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i);
    return pattern.test(email);
}

$(document).ready(function() {

    // Form-populate
    var autoPopulate = {{form_json}};
    jQuery.each(autoPopulate, function(key, data) {
        if ((key !== 'pass') && (key !== 'confirm')) $('input[name=' + key + ']').val(data);
    });
    
    $('input[name="name"]').focus();
    
    // Custom form validation
    $('input[name="email"]').blur(function() {
        $(this).parent().removeClass('form-red');
        if (!emailCheck($(this).val())) {
            $('#email-invalid').removeClass('alert-red alert-green').addClass('alert-red').html('<img src="/assets/icons/cross.png" title="[X]" /> Please input a valid email address.').show();
            $(this).parent().addClass('form-red');
            return null;
        }
        
        $.getJSON('/rpc.php', {method: 'checkEmail', data: $('input[name="email"]').val()}, function(r) {
            if (r.responseCode == 2200) {
                if (r.response) {
                    // Email's taken :(
                    $('#email-invalid').removeClass('alert-red alert-green').addClass('alert-red').html('<img src="/assets/icons/cross.png" title="[X]" /> Sorry, the email you entered is already in use. If you already have an account and wish to enroll another child, please login and use the "Add an Application" button.').show();
                    $(this).parent().addClass('form-red');
                } else {
                    $('#email-invalid').removeClass('alert-red alert-green').addClass('alert-green').html('<img src="/assets/icons/tick.png" title="[OK]" /> Email address is valid and ready for use.').show();
                }
            } else {
                $('#email-invalid').removeClass('alert-red alert-green').addClass('alert-red').html('<img src="/assets/icons/cross.png" title="[X]" /> An error occured while validating the email address you entered. Proceed with caution or try again later.').show();
                $(this).parent().addClass('form-red');
            }
        });
    });
    
    $('input[name="pass"]').blur(function() {
        $('#'+this.id).parent().removeClass('form-red');
        $('#password-invalid').hide();
        if ($(this).val().length < 6) {
            $('#'+this.id).parent().addClass('form-red');
            $('#'+this.id).parent().effect('pulsate', {times:2}, 400);
            $('#password-invalid').show();
            return false;
        }   
    });
    
    $('input[name="confirm"]').blur(function() {
        $('#'+this.id).parent().removeClass('form-red');
        $('#confirm-invalid').hide();
        if ($(this).val() !== $('input[name="pass"]').val()) {
            $('#'+this.id).parent().addClass('form-red');
            $('#'+this.id).parent().effect('pulsate', {times:2}, 400);
            $('#confirm-invalid').show();
            return false;
        }   
    });
    
    $('form').submit(function(e) {
        $('input[name="pass"]').parent().removeClass('form-red');
        $('#password-invalid').hide();
        $('#confirm-invalid').hide();
        $('#form-invalid').hide();
        
        if ($('input[name="pass"]').val().length < 6) {
            $('input[name="pass"]').parent().addClass('form-red');
            $.scrollTo('input[name="pass"]', 300, {offset: {top:-80}, onAfter: function() {
                $('input[name="pass"]').parent().effect('pulsate', {times:2}, 400);
                $('input[name="pass"]').focus();
            } });
            $('#password-invalid').show();
            $('#form-invalid').show();
            e.preventDefault();
            return false;
        }   
        
        $('input[name="confirm"]').parent().removeClass('form-red');
        if ($('input[name="confirm"]').val() !== $('input[name="pass"]').val()) {
            $('input[name="confirm"]').parent().addClass('form-red');
            $.scrollTo('input[name="confirm"]', 300, {offset: {top:-80}, onAfter: function() {
                $('input[name="confirm"]').parent().effect('pulsate', {times:2}, 400);
                $('input[name="confirm"]').focus();
            } });
            $('#confirm-invalid').show();
            $('#form-invalid').show();
            e.preventDefault();
            return false;
        }
    });
});
</script>